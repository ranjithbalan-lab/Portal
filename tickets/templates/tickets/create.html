{% extends "dashboard.html"%}

{% block title %}Submit New Support Ticket{% endblock %}

{% block content %}
<div class="w-full p-4 md:p-8 bg-white shadow-xl rounded-lg">
    
    <div class="flex items-center justify-between mb-8 border-b pb-4">
        <a href="{% url 'tickets:home' %}" class="flex items-center space-x-1 py-2 px-4 text-sm font-medium text-white bg-gray-500 rounded-lg hover:bg-gray-600 transition duration-150">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg> 
            <span>Back to Ticket List</span>
        </a>

        <h5 class="text-2xl font-bold text-gray-800 flex items-center">
            <svg class="w-6 h-6 mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            Submit New Support Ticket
        </h5>
        
        <div class="w-1/4"></div> 
    </div>

    <form method="POST" action="{% url 'tickets:store' %}" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

            {# TICKET CATEGORY #}
            <div class="flex flex-col">
                <label for="id_tk_category" class="block text-sm font-medium text-gray-700 mb-1">Category <span class="text-red-500">*</span></label>
                <select id="id_tk_category" name="tk_category" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2.5">
                    <option value="" disabled selected>Select Ticket Category</option>
                    {% for value, label in TICKET_CATEGORY_CHOICES %}
                        <option value="{{ value }}">{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            {# TICKET TYPE #}
            <div class="flex flex-col">
                <label for="id_tk_type" class="block text-sm font-medium text-gray-700 mb-1">Ticket Type <span class="text-red-500">*</span></label>
                <select id="id_tk_type" name="tk_type" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2.5">
                    <option value="" disabled selected>Please select a Category first</option>
                </select>
            </div>
            <script>
                const categorySelect = document.getElementById('id_tk_category');
                const typeSelect = document.getElementById('id_tk_type');

                // Define the choices from your Django model
                const hardwareChoices = [
                    {value: 'DE', label: 'Defect'},
                    {value: 'TS', label: 'Hardware Support'},
                    {value: 'PF', label: 'Physical Failure'},
                    {value: 'PD', label: 'Peripheral Devices'},
                    {value: 'IN', label: 'Installation Setup'},
                    {value: 'UP', label: 'Upgrade'},
                    {value: 'CI', label: 'Connectivity Problem'},
                    {value: 'DI', label: 'Diagnosis Inspection'}
                ];

                const softwareChoices = [
                    {value: 'DE', label: 'Defect'},
                    {value: 'NE', label: 'New Request'},
                    {value: 'TR', label: 'Training'},
                    {value: 'DC', label: 'Data Correction'},
                    {value: 'RM', label: 'Roadmap Support'},
                    {value: 'SU', label: 'Stock Update'},
                    {value: 'BI', label: 'Billing Inquiry'},
                    {value: 'FE', label: 'Feature Request'},
                    {value: 'OT', label: 'Other'}
                ];

                categorySelect.addEventListener('change', function() {
                    const selectedCategory = this.value; // 'HW' or 'SW'
                    
                    // Clear existing options
                    typeSelect.innerHTML = '<option value="" disabled selected>Select Ticket Type</option>';
                    
                    let choices = [];
                    if (selectedCategory === 'HW') {
                        choices = hardwareChoices;
                    } else if (selectedCategory === 'SW') {
                        choices = softwareChoices;
                    }

                    // Populate new options
                    choices.forEach(choice => {
                        const option = document.createElement('option');
                        option.value = choice.value;
                        option.textContent = choice.label;
                        typeSelect.appendChild(option);
                    });
                });
            </script>
            {# TICKET PRIORITY #}
            <div class="flex flex-col">
                <label for="id_tk_priority" class="block text-sm font-medium text-gray-700 mb-1">Priority <span class="text-red-500">*</span></label>
                <select id="id_tk_priority" name="tk_priority" required
                        class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2.5 focus:border-indigo-600 focus:ring-indigo-600 transition duration-150">
                    <option value="" disabled selected>Select Ticket Priority</option>
                    {% for value, label in TICKET_PRIORITY_CHOICES %}
                        <option value="{{ value }}">{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            {# REQUESTED BY #}
            <div class="flex flex-col">
                <label for="id_tk_req_by" class="block text-sm font-medium text-gray-700 mb-1">Requested By <span class="text-red-500">*</span></label>
                <input type="text" id="id_tk_req_by" name="tk_req_by" required
                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2.5 focus:border-indigo-600 focus:ring-indigo-600 transition duration-150"
                       placeholder="e.g., John Doe">
            </div>
            
            {# CONTACT PHONE #}
            <div class="flex flex-col">
                <label for="id_tk_req_phone" class="block text-sm font-medium text-gray-700 mb-1">Contact Phone <span class="text-red-500">*</span></label>
                <input type="text" id="id_tk_req_phone" name="tk_req_phone" required 
                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2.5 focus:border-indigo-600 focus:ring-indigo-600 transition duration-150"
                       placeholder="e.g., +91 98765 43210">
            </div>

            {# CONTACT EMAIL #}
            <div class="flex flex-col">
                <label for="id_tk_req_email" class="block text-sm font-medium text-gray-700 mb-1">Contact Email (Optional)</label>
                <input type="email" id="id_tk_req_email" name="tk_req_email"
                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2.5 focus:border-indigo-600 focus:ring-indigo-600 transition duration-150"
                       placeholder="john@example.com">
            </div>

            {# SYSTEM/UNIT AFFECTED #}
            <div class="flex flex-col">
                <label for="id_tk_unit" class="block text-sm font-medium text-gray-700 mb-1">System/Unit Affected</label>
                <input type="text" id="id_tk_unit" name="tk_unit"
                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2.5 focus:border-indigo-600 focus:ring-indigo-600 transition duration-150"
                       placeholder="e.g., HR System">
            </div>
            
            {# SPECIFIC MENU/MODULE #}
            <div class="flex flex-col">
                <label for="id_tk_menu" class="block text-sm font-medium text-gray-700 mb-1">Specific Menu/Module</label>
                <input type="text" id="id_tk_menu" name="tk_menu"
                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2.5 focus:border-indigo-600 focus:ring-indigo-600 transition duration-150"
                       placeholder="e.g., Payroll Screen">
            </div>
            <div class="flex flex-col">
                <label for="id_tk_attachment" class="block text-sm font-medium text-gray-700 mb-1">
                    Attach Document
                </label>
                <input type="file" id="id_tk_attachment" name="tk_attachment" 
                    class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2.5">
            </div>
            {# TARGET DUE DATE #}
            <div class="flex flex-col">
                <label for="id_tk_due_date" class="block text-sm font-medium text-gray-700 mb-1">Target Due Date (Optional)</label>
                <input type="date" id="id_tk_due_date" name="tk_due_date"
                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2.5 focus:border-indigo-600 focus:ring-indigo-600 transition duration-150">
            </div>

            {# SUBJECT / SHORT DESCRIPTION #}
            <div class="flex flex-col lg:col-span-1">
                <label for="id_tk_subject" class="block text-sm font-medium text-gray-800 mb-1">
                    Subject / Short Description <span class="text-red-500">*</span>
                </label>
                <input type="text" id="id_tk_subject" name="tk_subject" required
                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-3 focus:border-indigo-600 focus:ring-indigo-600 transition duration-150 text-base"
                       placeholder="e.g., VPN access broken">
                <p class="mt-2 text-xs text-gray-500 italic">Summarize the issue in a few words.</p>
            </div>

            {# DETAILED DESCRIPTION #}
            <div class="flex flex-col lg:col-span-2">
                <label for="id_tk_description" class="block text-sm font-medium text-gray-700 mb-1">
                    Detailed Description of Issue/Request
                </label>
                <textarea id="id_tk_description" name="tk_description" rows="5"
                        class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2.5 focus:border-indigo-600 focus:ring-indigo-600 transition duration-150"
                        placeholder="Provide steps to reproduce the issue..."></textarea>
            </div>
        </div> <div class="mt-10 pt-6 border-t flex justify-end space-x-4">
            <button type="submit" class="flex items-center space-x-2 py-2.5 px-6 text-sm font-medium text-white bg-indigo-600 rounded-lg shadow-md hover:bg-indigo-700 transition duration-150">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                <span>Submit Ticket</span>
            </button>
            
            <a href="{% url 'tickets:home' %}" class="flex items-center space-x-2 py-2.5 px-6 text-sm font-medium text-white bg-gray-500 rounded-lg shadow-sm hover:bg-gray-600 transition duration-150">
                <span>Cancel</span>
            </a>
        </div>
    </form>
</div>
{% endblock %}